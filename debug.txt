(venv) cui028@cui028-virtual-machine:~/ELLMERIntegration$ python robot_control/main.py --task "scan around and pick up the bottle"
SDK_VERSION: 1.17.0
[Config] Using default robot IP: 192.168.1.241
2025-09-12 23:59:34,097 - robot_control - INFO - Starting Robot Control System
2025-09-12 23:59:34,097 - robot_control - INFO - Connecting to robot at 192.168.1.241
ROBOT_IP: 192.168.1.241, VERSION: v2.5.1, PROTOCOL: V1, DETAIL: 6,12,FX8510,AC8500,v2.5.1, TYPE1300: [1, 1]
change protocol identifier to 3
[Robot] Connected to robot at 192.168.1.241
[Robot] Current state: (0, 2)
[Robot] Motion enabled
[Robot] Set to position control mode
[Robot] Set to ready state
[Robot] Final state: (0, 2)
[Robot] Robot is ready (state: 2)
[Robot] Set reduced TCP speed: 100
[Robot] Set reduced joint speed: 20
[Robot] Speed limits applied successfully
[Robot] Collision detection disabled for free movement
[Gripper] Dynamixel initialization failed: [Errno 2] could not open port /dev/ttyUSB0: [Errno 2] No such file or directory: '/dev/ttyUSB0'
[Gripper] Dynamixel failed to initialize, gripper disabled
2025-09-12 23:59:37,692 - robot_control - INFO - Robot connected successfully
2025-09-12 23:59:37,692 - robot_control - INFO - Starting vision system: robot_control/vision_system/apriltag_bridge.py
2025-09-12 23:59:37,694 - robot_control - INFO - Vision system started
2025-09-12 23:59:39,696 - robot_control - INFO - Executing task: scan around and pick up the bottle
[TaskExecutor] Using provided XArmRunner instance
[Vision] Vision system handled by main.py (apriltag_bridge.py)
[ObjectIndex] ROS2 subscription created for /detected_objects
[Vision] Vision system ready
2025-09-12 23:59:39,737 - robot_control - INFO - Planning task with True RAG intelligence: scan around and pick up the bottle
2025-09-12 23:59:43,858 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-09-12 23:59:46,556 - robot_control.rag_system.true_rag_planner - INFO - Loaded existing collection: robotics_knowledge
2025-09-12 23:59:46,558 - sentence_transformers.SentenceTransformer - INFO - Use pytorch device_name: cpu
2025-09-12 23:59:46,558 - sentence_transformers.SentenceTransformer - INFO - Load pretrained SentenceTransformer: all-MiniLM-L6-v2
2025-09-12 23:59:47,195 - robot_control.rag_system.true_rag_planner - INFO - Embedding model loaded successfully
Batches: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:01<00:00,  1.06s/it]
2025-09-12 23:59:48,403 - robot_control.rag_system.true_rag_planner - INFO - Added 27 documents to vector database
2025-09-12 23:59:48,404 - robot_control.rag_system.true_rag_planner - INFO - Indexed 27 knowledge documents (including action schema)
[WARN] [1757735988.404903332] [rcl.logging_rosout]: Publisher already registered for provided node name. If this is due to multiple nodes with the same name then all logs for that logger name will go out over the existing publisher. As soon as any node with that name is destructed it will unregister the publisher, preventing any further logs for that name from being published on the rosout topic.
[ObjectIndex] ROS2 subscription created for /detected_objects
2025-09-12 23:59:48,411 - robot_control.rag_system.true_rag_planner - INFO - Vision integration initialized for RAG system
2025-09-12 23:59:48,412 - robot_control.rag_system.true_rag_planner - INFO - True RAG Planner initialized with semantic knowledge retrieval
2025-09-12 23:59:48,412 - robot_control.rag_system.true_rag_planner - INFO - Starting RAG-based planning for: 'scan around and pick up the bottle'
Batches: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 51.83it/s]
2025-09-12 23:59:48,471 - robot_control.rag_system.true_rag_planner - INFO - Retrieved 5 relevant documents for query: scan around and pick up the bottle robot manipulation movement planning
2025-09-12 23:59:48,472 - robot_control.rag_system.true_rag_planner - INFO - Retrieved 5 relevant documents for: 'scan around and pick up the bottle'
[DEBUG] Raw position data: (0, [233.24971, -1.523109, 417.169647, -40.115296, 86.861949, -40.346943])
2025-09-12 23:59:54,960 - robot_control.rag_system.true_rag_planner - INFO - RAG planning completed with 5 retrieved documents
2025-09-12 23:59:54,961 - robot_control - INFO - RAG Plan Generated: Scan the environment, locate the bottle, and pick it up.
2025-09-12 23:59:54,961 - robot_control - INFO - Knowledge Retrieved: 5 documents
2025-09-12 23:59:54,961 - robot_control - INFO - Knowledge Categories: ['general']
2025-09-12 23:59:54,961 - robot_control - INFO - RAG Understanding: The user wants the robot to scan the environment and pick up a bottle. This requires scanning for the bottle, approaching it, grasping it, and then lifting it.
2025-09-12 23:59:54,961 - robot_control - INFO - Applied Knowledge: I will use the 'Complete Pick and Place Operation' knowledge to guide the overall plan. I will also use the action schema to ensure all actions are valid and correctly formatted. The 'Safe Object Approach' pattern will be used for approaching the bottle.
[Plan] Goal: Scan the environment, locate the bottle, and pick it up.
[Plan] Gripper status: {'enabled': False, 'position': None, 'error': 'Gripper not enabled'}
[Plan] Step 1/6: SCAN_AREA {'action': 'SCAN_AREA', 'pattern': 'horizontal', 'sweep_mm': 300, 'steps': 5, 'knowledge_source': 'Knowledge 1, Knowledge 2'}
[SCAN] Starting arc scan for objects: any
[ARC_SCAN] ========== STARTING ARC SCAN DEBUG ==========
[ARC_SCAN] Target objects: any object
[ARC_SCAN] Interrupt on detection: True
[ARC_SCAN] Scan sequence: ['LEFT', 'CENTER', 'RIGHT']
[ARC_SCAN] ========== LEFT POSITION ==========
[ARC_SCAN] Target joint angles: [46, -57, -74, -74, -90.4, -18.4]
[ARC_SCAN] Current joint angles: [-0.762664, 32.806819, 0.28751, -180.595781, -59.883085, -1.656192, 0.0]
[ARC_SCAN] Moving to LEFT position...
[ARC_SCAN] Final joint angles: [45.999974, -57.000019, -74.00002, -74.00002, -90.40002, -18.400024, 0.0]
[ARC_SCAN] Joint angle differences: [2.5999999998305157e-05, 1.9000000001767603e-05, 2.0000000006348273e-05, 2.0000000006348273e-05, 1.9999999992137418e-05, 2.3999999999801958e-05]
[DEBUG] Raw position+RPY data: (0, [459.270386, 350.52002, 206.215118, -154.430747, 85.306254, 146.084413])
[ARC_SCAN] TCP Position: [459.270386, 350.52002, 206.215118]
[ARC_SCAN] TCP RPY: [-154.430747, 85.306254, 146.084413]
[ARC_SCAN] Scanning for objects at LEFT position...
[OBJECT_CHECK] ========== OBJECT DETECTION DEBUG ==========
[OBJECT_CHECK] Pause duration: 2.0s
[OBJECT_CHECK] Target objects: any
[OBJECT_CHECK] Interrupt on detection: True
[OBJECT_CHECK] Check #1 at 0.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #2 at 0.4s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #3 at 0.6s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #4 at 0.8s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #5 at 1.0s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #6 at 1.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #7 at 1.4s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #8 at 1.6s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #9 at 1.8s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #10 at 2.0s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #11 at 2.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Scan timeout - no targets found after 11 checks
[OBJECT_CHECK] ==========================================
[ARC_SCAN] ========== CENTER POSITION ==========
[ARC_SCAN] Target joint angles: [-0.7, 3.3, 1.1, -180.5, -90.2, -2]
[ARC_SCAN] Current joint angles: [45.999974, -57.000019, -74.00002, -74.00002, -90.40002, -18.400024, 0.0]
[ARC_SCAN] Moving to CENTER position...
[ARC_SCAN] Final joint angles: [-0.699983, 3.300008, 1.100022, -180.499983, -90.200001, -2.000024, 0.0]
[ARC_SCAN] Joint angle differences: [1.6999999999933735e-05, 8.000000000230045e-06, 2.199999999996649e-05, 1.7000000013922545e-05, 9.999999974752427e-07, 2.3999999999801958e-05]
[DEBUG] Raw position+RPY data: (0, [233.246902, -1.521958, 337.164917, -40.120224, 86.862522, -40.351756])
[ARC_SCAN] TCP Position: [233.246902, -1.521958, 337.164917]
[ARC_SCAN] TCP RPY: [-40.120224, 86.862522, -40.351756]
[ARC_SCAN] Scanning for objects at CENTER position...
[OBJECT_CHECK] ========== OBJECT DETECTION DEBUG ==========
[OBJECT_CHECK] Pause duration: 2.0s
[OBJECT_CHECK] Target objects: any
[OBJECT_CHECK] Interrupt on detection: True
[OBJECT_CHECK] Check #1 at 0.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #2 at 0.4s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #3 at 0.6s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #4 at 0.8s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #5 at 1.0s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #6 at 1.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #7 at 1.4s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #8 at 1.6s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #9 at 1.8s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #10 at 2.0s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #11 at 2.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Scan timeout - no targets found after 11 checks
[OBJECT_CHECK] ==========================================
[ARC_SCAN] ========== RIGHT POSITION ==========
[ARC_SCAN] Target joint angles: [-53, -57, -64, -281, -87, 0]
[ARC_SCAN] Current joint angles: [-0.699983, 3.300008, 1.100022, -180.499983, -90.200001, -2.000024, 0.0]
[ARC_SCAN] Moving to RIGHT position...
[ARC_SCAN] Final joint angles: [-53.000028, -57.000019, -64.000016, -280.999989, -86.999974, 0.0, 0.0]
[ARC_SCAN] Joint angle differences: [2.800000000036107e-05, 1.9000000001767603e-05, 1.6000000002236447e-05, 1.099999997222767e-05, 2.6000000005410584e-05, 0.0]
[DEBUG] Raw position+RPY data: (0, [377.044678, -356.097107, 164.879318, -122.196371, 81.874294, -74.488524])
[ARC_SCAN] TCP Position: [377.044678, -356.097107, 164.879318]
[ARC_SCAN] TCP RPY: [-122.196371, 81.874294, -74.488524]
[ARC_SCAN] Scanning for objects at RIGHT position...
[OBJECT_CHECK] ========== OBJECT DETECTION DEBUG ==========
[OBJECT_CHECK] Pause duration: 2.0s
[OBJECT_CHECK] Target objects: any
[OBJECT_CHECK] Interrupt on detection: True
[OBJECT_CHECK] Check #1 at 0.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #2 at 0.4s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #3 at 0.6s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #4 at 0.8s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #5 at 1.0s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #6 at 1.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #7 at 1.4s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #8 at 1.6s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #9 at 1.8s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #10 at 2.0s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Check #11 at 2.2s:
[OBJECT_CHECK]   Detected objects: []
[OBJECT_CHECK] Scan timeout - no targets found after 11 checks
[OBJECT_CHECK] ==========================================
[ARC_SCAN] ========== SCAN COMPLETE ==========
[ARC_SCAN] No targets found, returning to center position
[SCAN] Arc scan completed - no target objects found
[Plan] Step 2/6: OPEN_GRIPPER {'action': 'OPEN_GRIPPER', 'gripper': {'position': 850, 'speed': 200}, 'knowledge_source': 'Knowledge 1, Knowledge 2'}
[Gripper] Gripper not enabled
[Plan] Step 3/6: APPROACH_OBJECT {'action': 'APPROACH_OBJECT', 'label': 'bottle', 'hover_mm': 80, 'timeout_sec': 5, 'knowledge_source': 'Knowledge 1, Knowledge 2'}
[APPROACH] ========== APPROACH OBJECT DEBUG ==========
[APPROACH] Target label: bottle
[APPROACH] Approach distance: 30mm
[APPROACH] No stored detection state, calculating fresh coordinates
[DEBUG] Raw position+RPY data: (0, [233.246902, -1.521958, 337.164917, -40.120224, 86.862522, -40.351756])
[APPROACH] Current TCP position: [233.246902, -1.521958, 337.164917]
[APPROACH] Current TCP RPY: [-40.120224, 86.862522, -40.351756]
[APPROACH] ERROR: Could not get coordinates for bottle
[APPROACH] Available objects: []
[Plan] Step 4/6: MOVE_TO_OBJECT {'action': 'MOVE_TO_OBJECT', 'label': 'bottle', 'offset_mm': [0, 0, 0], 'timeout_sec': 5, 'knowledge_source': 'Knowledge 1, Knowledge 2'}
[APPROACH] ========== APPROACH OBJECT DEBUG ==========
[APPROACH] Target label: bottle
[APPROACH] Approach distance: 30mm
[APPROACH] No stored detection state, calculating fresh coordinates
[DEBUG] Raw position+RPY data: (0, [233.246902, -1.521958, 337.164917, -40.120224, 86.862522, -40.351756])
[APPROACH] Current TCP position: [233.246902, -1.521958, 337.164917]
[APPROACH] Current TCP RPY: [-40.120224, 86.862522, -40.351756]
[APPROACH] ERROR: Could not get coordinates for bottle
[APPROACH] Available objects: []
[Plan] Step 5/6: GRIPPER_GRASP {'action': 'GRIPPER_GRASP', 'target_position': 200, 'speed': 100, 'force': 50, 'timeout': 5.0, 'knowledge_source': 'Knowledge 1, Knowledge 2'}
[Gripper] Gripper not enabled
[Plan] Step 6/6: RETREAT_Z {'action': 'RETREAT_Z', 'dz_mm': 100, 'knowledge_source': 'Knowledge 1, Knowledge 2'}
[DEBUG] Raw position data: (0, [233.246902, -1.521958, 337.164917, -40.120224, 86.862522, -40.351756])
[Robot] Moved relative Z by 100.0mm
[Plan] Done. Execution time: 25.6s, Steps completed: 6
2025-09-13 00:00:20,559 - robot_control - INFO - Cleaning up system resources
2025-09-13 00:00:20,701 - robot_control - INFO - Vision system stopped
(venv) cui028@cui028-virtual-machine:~/ELLMERIntegration$ 